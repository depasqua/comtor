<?xml version="1.0"?>

<project name="comtor" default="compile" basedir=".">
	<description>Build file for the COMTOR application(s)</description>
	
	<!-- Define some basic properties for later on. -->
	<property name="src" location="src"/>
	<property name="classes" location="classes"/>
	<property name="thirdpartyjars" location="${basedir}/../comtor_data/code/"/>
	
	<target name="init" description="Pre-build tasks">
		<mkdir dir="${classes}"/>
	</target>
	
	<!-- Build up a classpath file path for later use. -->
	
	<!-- Commented out for possible removal.
		<pathelement location="${thirdpartyjars}/comtor.jar"/>
		<pathelement location="${thirdpartyjars}/antlr-3.1.1-runtime.jar"/>
		<pathelement location="${thirdpartyjars}/stringtemplate-3.2.jar"/>
	-->
	
	<path id="comtor.class.path">
		<pathelement path="${classes}"/>
		<pathelement location="${thirdpartyjars}/antlr-3.1.1.jar"/>
		<pathelement location="${thirdpartyjars}/mysql-connector-java-5.1.6-bin.jar"/>
		<pathelement path="${java.home}/jre/lib/tools.jar"/>
		<pathelement path="${java.home}/../Classes/classes.jar"/> <!-- classes.jar is tools.jar on the mac -->
	</path>
	
	<!-- Compile the source files -->
	<target name="compile" description="Compile the source" depends="init">
		<javac srcdir="${src}" destdir="${classes}" compiler="javac1.5" includeantruntime="false" excludes="comtor/incomplete/** comtor/examples/**">
			<classpath refid="comtor.class.path"/> 
		</javac>
	</target>
	
	<!-- Deploys comtor.jar to the proper path -->
	<target name="deploy" description="jars and deploys comtor.jar to proper directory" depends="compile">
		<jar destfile="${thirdpartyjars}/comtor.jar" basedir="${classes}" />
	</target>
	
	<!-- Removes the class files, source backups, and debug output -->
	<target name="clean" description="Clean source backups and obj files">
		<delete dir="${classes}"/>
		
		<delete>
			<fileset dir="." casesensitive="yes">
				<include name="**/*~ "/>
				<include name="comtorReport.txt"/>
				<include name="comtor.jar"/>
			</fileset>
		</delete>		
	</target>
	
	<target name="makeStandAlone" depends="compile"
		description="Builds a distributable .jar file for use as a stand-alone application">
		<tstamp/>
		<jar destfile="comtor.jar">
			<manifest>
				<attribute name="Main-Class" value="comtor.Comtor"/>
				<attribute name="Built-By" value="${user.name}"/>
				<attribute name="Implementation-Title" value="COMTOR"/>
				<attribute name="Implementation-Version" value="${version} ${TODAY}"/> 
				<attribute name="Implementation-Vendor" value="The College of New Jersey"/>
			</manifest>
			<fileset dir="classes">
				<include name="**/*.class"/>
			</fileset>
			<fileset dir=".">
				<include name="Doclets.txt"/>
			</fileset>
		</jar>
	</target>

</project>
